namespace = ate_religious_decision


ate_religious_decision.80 = { #select procer
	type = character_event
	title = ate_religious_decision.80.t
	desc = ate_religious_decision.80.desc
	theme = faith
	left_portrait = {
		character = root
		animation = personality_rational
	}

	# Bolivar
	option = {
		name = ate_religious_decision.80.a
		add_piety = medium_piety_loss
		if = {
			limit = {
				has_religion = religion:christianity_religion
			}
			add_character_modifier = pantheon_bolivar_1
		}
		else = {
			add_character_modifier = pantheon_bolivar_2
		}
	}
	# Santander
	option = {
		name = ate_religious_decision.80.b
		add_piety = medium_piety_loss
		if = {
			limit = {
				has_religion = religion:christianity_religion
			}
			add_character_modifier = pantheon_santander_1
		}
		else = {
			add_character_modifier = pantheon_santander_2
		}
	}
	# Manuelita
	option = {
		name = ate_religious_decision.80.c
		add_piety = medium_piety_loss
		if = {
			limit = {
				has_religion = religion:christianity_religion
			}
			add_character_modifier = pantheon_manuelita_1
		}
		else = {
			add_character_modifier = pantheon_manuelita_2
		}
	}
	# La Pola
	option = {
		name = ate_religious_decision.80.d
		add_piety = medium_piety_loss
		if = {
			limit = {
				has_religion = religion:christianity_religion
			}
			add_character_modifier = pantheon_la_pola_1
		}
		else = {
			add_character_modifier = pantheon_la_pola_2
		}
	}
	# Opt-Out
	option = {
		name = ate_religious_decision.80.e

		ai_chance = {
			base = 0
		}		
	}
}

ate_religious_decision.81 = { #beginning of assembly
	type = character_event
	title = ate_religious_decision.81.t
	immediate = {
		title:c_co_21_c_cuta = {
			holder = {
				save_scope_as = cucuta_holder
			}
		}
		root = {
			save_scope_as = caudillo
		}
	}
	desc = {
		desc = ate_religious_decision.81.desc.start
		first_valid = {
			triggered_desc = {
				trigger = {
					has_title = c_co_21_c_cuta #caudillo owns cucuta, check if the county keeps that name
				}
				desc = ate_religious_decision.81.desc.cucuta
			}
			triggered_desc = {
				trigger = {
					title:c_co_21_c_cuta = {
						this.holder.faith = faith:patria_grande
					}
				}
				desc = ate_religious_decision.81.desc.faithful
			}
			desc = ate_religious_decision.81.desc.infidel
		}
	}
	theme = faith
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = ate_religious_decision.81.a
		if = {
			limit = {
				highest_held_title_tier > tier_kingdom
			}
			add_gold = major_gold_loss
			if = {
				limit = {
					title:c_co_21_c_cuta = {
						NOT = {
							this.holder.faith = faith:patria_grande
						}
					}	
				}
				add_gold = major_gold_loss
			}
		}
		else_if = {
			limit = {
				highest_held_title_tier = tier_kingdom
			}
			add_gold = medium_gold_loss
			if = {
				limit = {
					title:c_co_21_c_cuta = {
						NOT = {
							this.holder.faith = faith:patria_grande
						}
					}	
				}
				add_gold = medium_gold_loss
			}
		}
		else = {
			add_gold = minor_gold_loss
			if = {
				limit = {
					title:c_co_21_c_cuta = {
						NOT = {
							this.holder.faith = faith:patria_grande
						}
					}	
				}
				add_gold = minor_gold_loss
			}
		}
		hidden_effect = {
			every_player = {
				limit = {
					this.faith = faith:patria_grande
					NOT = {
						has_title = d_caudillo_patria_grande
					}
				}
				trigger_event = {
					id = ate_religious_decision.82
					days = 7
				}
			}
			if = {
				limit = {
					is_ai = no
				}
				trigger_event = {
					id = ate_religious_decision.84
					days = 14
				}
			}
		}
	}
	option = {
		name = ate_religious_decision.81.b
		trigger = {
			NOT = {
				has_title = c_co_21_c_cuta
			}
			c_co_21_c_cuta = {
				this.holder.faith = faith:patria_grande
			}			
		}
		if = {
			limit = {
				NOT = {
					has_relation_rival = scope:cucuta_holder
				}
			}
			hidden_effect = {
				if = {
					limit = {
						has_relation_potential_rival = scope:cucuta_holder
					}
					remove_relation_potential_rival = scope:cucuta_holder
				}
			}
			set_relation_rival = scope:cucuta_holder
		}
		scope:cucuta_holder = {
			add_character_flag = {
				flag = cucuta_forced_to_pay
				years = 2
			}
		}
		hidden_effect = {
			every_player = {
				limit = {
					this.faith = faith:patria_grande
					NOT = {
						has_title = d_caudillo_patria_grande
					}
				}
				trigger_event = {
					id = ate_religious_decision.82
					days = 7
				}
			}
			if = {
				limit = {
					is_ai = no
				}
				trigger_event = {
					id = ate_religious_decision.84
					days = 14
				}
			}
		}
	}
}

ate_religious_decision.82 = { #call of democracy
	type = character_event
	title = ate_religious_decision.82.t
	desc = {
		desc = ate_religious_decision.82.desc.start
		triggered_desc = {
			trigger = {
				has_character_flag = cucuta_forced_to_pay #caudillo forces cucuta owned to pay up
			}
			desc = ate_religious_decision.82.desc.cucuta
		}
	}
	theme = faith
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = ate_religious_decision.82.a
		trigger = {
			has_title = c_co_21_c_cuta
		}
		if = {
			limit = {
				has_character_flag = cucuta_forced_to_pay
			}
			remove_short_term_gold = pilgrimage_medium_extra_cost
		}
		hidden_effect = {
			if = {
				limit = {
					any_vassal = {
						is_powerful_vassal = yes
						this.faith = faith:patria_grande
					}
				}
				trigger_event = {
					id = ate_religious_decision.83
					days = 3				
				}
			}
			else = {
				trigger_event = {
					id = ate_religious_decision.84
					days = 7
				}
			}
		}
	}
	option = {
		name = ate_religious_decision.82.b
		trigger = {
			NOT = {
				has_title = c_co_21_c_cuta
			}
			root = {
				NOR = {
					is_imprisoned = yes
					is_incapable = yes
				}
			}
		}
		remove_short_term_gold = pilgrimage_minimum_cost
		hidden_effect = {
			if = {
				limit = {
					any_vassal = {
						is_powerful_vassal = yes
						this.faith = faith:patria_grande
					}
				}
				trigger_event = {
					id = ate_religious_decision.83
					days = 3				
				}
			}
			else = {
				trigger_event = {
					id = ate_religious_decision.84
					days = 7
				}
			}
		}
	}
	option = {
		name = ate_religious_decision.82.c
		trigger = {
			NOT = {
				has_title = c_co_21_c_cuta
			}
			root = {
				primary_heir = {
					is_landed = NOT
				}
				NOR = {
					is_imprisoned = yes
					is_incapable = yes
				}
			}
		}
		hidden_effect = {
			if = {
				limit = {
					any_vassal = {
						is_powerful_vassal = yes
						this.faith = faith:patria_grande
					}
				}
				trigger_event = {
					id = ate_religious_decision.83
					days = 3				
				}
			}
			else = {
				trigger_event = {
					id = ate_religious_decision.84
					days = 7
				}
			}
		}
		remove_short_term_gold = pilgrimage_medium_extra_cost
	}
	option = {
		name = ate_religious_decision.82.d
		trigger = {
			NOT = {
				has_title = c_co_21_c_cuta
			}
			root = {
				OR = {
					is_imprisoned = yes
					is_incapable = yes
				}
			}
		}
		add_piety = -10
	}
	option = {
		name = ate_religious_decision.82.e
		trigger = {
			NOT = {
				has_title = c_co_21_c_cuta
			}
			root = {
				NOR = {
					is_imprisoned = yes
					is_incapable = yes
				}
			}
		}
		add_piety = -50
	}	
}

ate_religious_decision.83 = { #an unseemly proposal
	type = character_event
	title = ate_religious_decision.83.t
	desc = ate_religious_decision.83.desc
	immediate = {
		random_vassal = {
			limit = {
				is_powerful_vassal = yes
				this.faith = faith:patria_grande
			}
			save_scope_as = briber
		}
	}
	theme = faith
	left_portrait = {
		character = root
		animation = personality_rational
	}

	right_portrait = {
		character = briber
		animation = scheme
	}

	option = {
		name = ate_religious_decision.83.a
		if = {
			limit = {
				has_trait = greedy
			}
			add_stress = 20
		}
		add_piety = 25
		reverse_add_opinion = {
			target = scope:briber
			modifier = assembly_bribe_refused
		}
		hidden_effect = {
			trigger_event = {
				id = ate_religious_decision.84
				days = 4
			}
		}
	}
	option = {
		name = ate_religious_decision.83.b
		if = {
			limit = {
				OR = {
					has_trait = honest
					has_trait = zealous
				}
			}
			add_stress = 20
		}
		if = {
			limit = {
				can_add_hook = {
					type = favor_hook
					target = scope:briber
				}
			}
			add_hook = {
				type = favor_hook
				target = scope:briber
			}
		}
		random_list = {
			60 = {
			}
			40 = {
				add_character_modifier = {
					modifier = corrupt_elector_assembly
					years = 20
				}
			}
		}
	}
}

ate_religious_decision.84 = { #time to begin
	type = character_event
	title = ate_religious_decision.84.t
	desc = {
		desc = ate_religious_decision.84.desc.start
		first_valid = {
			triggered_desc = {
				trigger = {
					has_title = d_caudillo_patria_grande
				}
				desc = ate_religious_decision.84.desc.caudillo
			}
			desc = ate_religious_decision.84.desc.else
		}
		desc = ate_religious.decision.84.desc.end
	}
	theme = faith
	left_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = ate_religious_decision.84.a
		trigger = {
			has_title = d_caudillo_patria_grande
		}
	}
	option = {
		name = ate_religious_decision.84.b
		if = {
			limit = {
				has_title = d_caudillo_patria_grande
			}
			add_tyranny = 15
				set_doctrine_deviancy_accepted = yes
				set_doctrine_adultery_men_accepted = yes
				set_doctrine_adultery_women_accepted = yes
				set_doctrine_homosexuality_accepted = yes
		}
		else = {
			if = {
				limit = {
					root.intrigue >= 17
				}
				random_list = {
					90 = {
						set_doctrine_deviancy_accepted = yes
						set_doctrine_adultery_men_accepted = yes
						set_doctrine_adultery_women_accepted = yes
						set_doctrine_homosexuality_accepted = yes
					}
					5 = {
						set_doctrine_deviancy_shunned = yes
						set_doctrine_adultery_men_shunned = yes
						set_doctrine_adultery_women_shunned = yes
						set_doctrine_homosexuality_shunned = yes
					}
					5 = {
						set_doctrine_deviancy_crime = yes
						set_doctrine_adultery_men_crime = yes
						set_doctrine_adultery_women_crime = yes
						set_doctrine_homosexuality_crime = yes
					}
				}
			}
			else_if = {
				limit = {
					root.intrigue >= 13
				}
				random_list = {
					70 = {
						set_doctrine_deviancy_accepted = yes
						set_doctrine_adultery_men_accepted = yes
						set_doctrine_adultery_women_accepted = yes
						set_doctrine_homosexuality_accepted = yes
					}
					15 = {
						set_doctrine_deviancy_shunned = yes
						set_doctrine_adultery_men_shunned = yes
						set_doctrine_adultery_women_shunned = yes
						set_doctrine_homosexuality_shunned = yes
					}
					15 = {
						set_doctrine_deviancy_crime = yes
						set_doctrine_adultery_men_crime = yes
						set_doctrine_adultery_women_crime = yes
						set_doctrine_homosexuality_crime = yes
					}
				}				
			}
			else = {
				random_list = {
					40 = {
						set_doctrine_deviancy_accepted = yes
						set_doctrine_adultery_men_accepted = yes
						set_doctrine_adultery_women_accepted = yes
						set_doctrine_homosexuality_accepted = yes
					}
					30 = {
						set_doctrine_deviancy_shunned = yes
						set_doctrine_adultery_men_shunned = yes
						set_doctrine_adultery_women_shunned = yes
						set_doctrine_homosexuality_shunned = yes
					}
					30 = {
						set_doctrine_deviancy_crime = yes
						set_doctrine_adultery_men_crime = yes
						set_doctrine_adultery_women_crime = yes
						set_doctrine_homosexuality_crime = yes
					}
				}				
			}
		}
	}
	option = {
		name = ate_religious_decision.84.c
		if = {
			limit = {
				has_title = d_caudillo_patria_grande
			}
			add_tyranny = 15
				set_doctrine_deviancy_shunned = yes
				set_doctrine_adultery_men_shunned = yes
				set_doctrine_adultery_women_shunned = yes
				set_doctrine_homosexuality_shunned = yes
		}
		else = {
			if = {
				limit = {
					root.intrigue >= 17
				}
				random_list = {
					90 = {
						set_doctrine_deviancy_shunned = yes
						set_doctrine_adultery_men_shunned = yes
						set_doctrine_adultery_women_shunned = yes
						set_doctrine_homosexuality_shunned = yes
					}
					5 = {
						set_doctrine_deviancy_accepted = yes
						set_doctrine_adultery_men_accepted = yes
						set_doctrine_adultery_women_accepted = yes
						set_doctrine_homosexuality_accepted = yes
					}
					5 = {
						set_doctrine_deviancy_crime = yes
						set_doctrine_adultery_men_crime = yes
						set_doctrine_adultery_women_crime = yes
						set_doctrine_homosexuality_crime = yes
					}
				}
			}
			else_if = {
				limit = {
					root.intrigue >= 13
				}
				random_list = {
					70 = {
						set_doctrine_deviancy_shunned = yes
						set_doctrine_adultery_men_shunned = yes
						set_doctrine_adultery_women_shunned = yes
						set_doctrine_homosexuality_shunned = yes
					}
					15 = {
						set_doctrine_deviancy_accepted = yes
						set_doctrine_adultery_men_accepted = yes
						set_doctrine_adultery_women_accepted = yes
						set_doctrine_homosexuality_accepted = yes
					}
					15 = {
						set_doctrine_deviancy_crime = yes
						set_doctrine_adultery_men_crime = yes
						set_doctrine_adultery_women_crime = yes
						set_doctrine_homosexuality_crime = yes
					}
				}				
			}
			else = {
				random_list = {
					40 = {
						set_doctrine_deviancy_shunned = yes
						set_doctrine_adultery_men_shunned = yes
						set_doctrine_adultery_women_shunned = yes
						set_doctrine_homosexuality_shunned = yes
					}
					30 = {
						set_doctrine_deviancy_accepted = yes
						set_doctrine_adultery_men_accepted = yes
						set_doctrine_adultery_women_accepted = yes
						set_doctrine_homosexuality_accepted = yes
					}
					30 = {
						set_doctrine_deviancy_crime = yes
						set_doctrine_adultery_men_crime = yes
						set_doctrine_adultery_women_crime = yes
						set_doctrine_homosexuality_crime = yes
					}
				}				
			}
		}
	}
	option = {
		name = ate_religious_decision.84.d
		if = {
			limit = {
				has_title = d_caudillo_patria_grande
			}
			add_tyranny = 15
				set_doctrine_deviancy_crime = yes
				set_doctrine_adultery_men_crime = yes
				set_doctrine_adultery_women_crime = yes
				set_doctrine_homosexuality_crime = yes
		}
		else = {
			if = {
				limit = {
					root.intrigue >= 17
				}
				random_list = {
					90 = {
						set_doctrine_deviancy_crime = yes
						set_doctrine_adultery_men_crime = yes
						set_doctrine_adultery_women_crime = yes
						set_doctrine_homosexuality_crime = yes
					}
					5 = {
						set_doctrine_deviancy_accepted = yes
						set_doctrine_adultery_men_accepted = yes
						set_doctrine_adultery_women_accepted = yes
						set_doctrine_homosexuality_accepted = yes
					}
					5 = {
						set_doctrine_deviancy_shunned = yes
						set_doctrine_adultery_men_shunned = yes
						set_doctrine_adultery_women_shunned = yes
						set_doctrine_homosexuality_shunned = yes
					}
				}
			}
			else_if = {
				limit = {
					root.intrigue >= 13
				}
				random_list = {
					70 = {
						set_doctrine_deviancy_crime = yes
						set_doctrine_adultery_men_crime = yes
						set_doctrine_adultery_women_crime = yes
						set_doctrine_homosexuality_crime = yes
					}
					15 = {
						set_doctrine_deviancy_accepted = yes
						set_doctrine_adultery_men_accepted = yes
						set_doctrine_adultery_women_accepted = yes
						set_doctrine_homosexuality_accepted = yes
					}
					15 = {
						set_doctrine_deviancy_shunned = yes
						set_doctrine_adultery_men_shunned = yes
						set_doctrine_adultery_women_shunned = yes
						set_doctrine_homosexuality_shunned = yes
					}
				}				
			}
			else = {
				random_list = {
					40 = {
						set_doctrine_deviancy_crime = yes
						set_doctrine_adultery_men_crime = yes
						set_doctrine_adultery_women_crime = yes
						set_doctrine_homosexuality_crime = yes
					}
					30 = {
						set_doctrine_deviancy_accepted = yes
						set_doctrine_adultery_men_accepted = yes
						set_doctrine_adultery_women_accepted = yes
						set_doctrine_homosexuality_accepted = yes
					}
					30 = {
						set_doctrine_deviancy_shunned = yes
						set_doctrine_adultery_men_shunned = yes
						set_doctrine_adultery_women_shunned = yes
						set_doctrine_homosexuality_shunned = yes
					}
				}				
			}
		}
	}
}

#Anima Tragedy
ate_religious_decision.100 = {
	type = character_event

	hidden = yes

	trigger = {
		trigger_if = {
			limit = {
				exists = scope:killer
			}
			NOT = { this = scope:killer } #Killers already know
		}
	}

	immediate = { #Finds most important relation for notification & mourning events

		if = {
			limit = { #To block the player from getting events about themselves dying
				NOT = {
					is_player_heir_of_trigger = { CHARACTER = scope:dead_character }
				}
				NOT = {
					scope:dead_character = { #Older people are expected to die
						effective_age > 40
					}
				}
			}
			if = { #Spouse
				limit = {
					exists = scope:prison_holder
					NOT = { this = scope:prison_holder }
					any_consort = { even_if_dead = yes this = scope:dead_character }
				}
				set_variable = {
					name = tragical_anima
					value = scope:dead_character
					years = 5
				}
			}
			
			else_if = { #Spouse
				limit = {
					exists = scope:prison_holder
					this = scope:prison_holder
					any_consort = { even_if_dead = yes this = scope:dead_character }
				}
			}

			else_if = { #Spouse
				limit = {
					exists = scope:house_arrest_holder
					any_consort = { even_if_dead = yes this = scope:dead_character }
				}
			}

			else_if = { #Spouse
				limit = {
					any_consort = { even_if_dead = yes this = scope:dead_character }
				}
				set_variable = {
					name = tragical_anima
					value = scope:dead_character
					years = 5
				}
			}

			else_if = { #Heir
				limit = {
					exists = scope:prison_holder
					NOT = { this = scope:prison_holder }
					is_in_list = title_holder_list
				}
				set_variable = {
					name = tragical_anima
					value = scope:dead_character
					years = 5
				}
			}

			else_if = { #Heir
				limit = {
					exists = scope:house_arrest_holder
					is_in_list = title_holder_list
					is_close_or_extended_family_of = scope:dead_character
				}
				set_variable = {
					name = tragical_anima
					value = scope:dead_character
					years = 5
				}
			}

			else_if = { #Heir
				limit = {
					is_in_list = title_holder_list
					is_close_or_extended_family_of = scope:dead_character
				}
				set_variable = {
					name = tragical_anima
					value = scope:dead_character
					years = 5
				}
				trigger_event = {
					id = ate_religious_decision.99
					delayed = yes
				}
			}

			else_if = { #Betrothed
				limit = {
					exists = scope:prison_holder
					NOT = { this = scope:prison_holder }
					is_in_list = send_death_management_0002_betrothed
				}
				set_variable = {
					name = tragical_anima
					value = scope:dead_character
					years = 5
				}
			}

			else_if = { #Betrothed
				limit = {
					exists = scope:house_arrest_holder
					is_in_list = send_death_management_0002_betrothed
				}
				set_variable = {
					name = tragical_anima
					value = scope:dead_character
					years = 5
				}
			}

			else_if = { #Betrothed
				limit = {
					is_in_list = send_death_management_0002_betrothed
				}
				set_variable = {
					name = tragical_anima
					value = scope:dead_character
					years = 5
				}
			}

			else_if = { #Child
				limit = {
					exists = scope:prison_holder
					NOT = { this = scope:prison_holder }
					any_child = { even_if_dead = yes this = scope:dead_character }
				}
				set_variable = {
					name = tragical_anima
					value = scope:dead_character
					years = 5
				}

			}

			else_if = { #Child
				limit = {
					exists = scope:house_arrest_holder
					any_child = { even_if_dead = yes this = scope:dead_character }
				}
				set_variable = {
					name = tragical_anima
					value = scope:dead_character
					years = 5
				}
			}

			else_if = { #Child
				limit = {
					any_child = { even_if_dead = yes this = scope:dead_character }
				}
				set_variable = {
					name = tragical_anima
					value = scope:dead_character
					years = 5
				}
			}

			else_if = { #Sibling
				limit = {
					any_sibling = { even_if_dead = yes this = scope:dead_character }
				}
				set_variable = {
					name = tragical_anima
					value = scope:dead_character
					years = 5
				}
			}

			else_if = { #Lover
				limit = {
					is_in_list = send_death_management_0002_lover
				}
				if = {
					limit = {
						has_character_flag = important_lover
					}
				}
				else = {
					set_variable = {
						name = tragical_anima
						value = scope:dead_character
						years = 5
					}
				}
			}

			else_if = { #Friend
				limit = {
					is_in_list = send_death_management_0002_friend
				}
				if = {
					limit = {
						opinion = {
							target = scope:dead_character
							value >= 50
						}
					}
					set_variable = {
						name = tragical_anima
						value = scope:dead_character
						years = 5
					}
				}
				else = {
					set_variable = {
						name = tragical_anima
						value = scope:dead_character
						years = 5
					}
				}
			}

			else_if = {
				limit = {
					any_child = {
						any_relation = { type = guardian even_if_dead = yes this = scope:dead_character }
					}
				}
				set_variable = {
					name = tragical_anima
					value = scope:dead_character
					years = 5
				}
			}
		}
	}
}	

#New holder of the county with an anima
ate_religious_decision.101 = {
	hidden = yes
	
	trigger = {
		scope:title = {
			exists = var:tragical_anima
		}
		NOT = { 
			faith = {
				has_doctrine_parameter = anima_shrines_active
			} 
		}
	}

	immediate = {
		scope:title = {
			remove_county_modifier = county_dedicated_anima_shrine
			remove_county_modifier = county_dedicated_anima_sanctuary
		}
	}
}

#Anima grows
ate_religious_decision.102 = {
	title = ate_religious_decision.102.t
	desc = ate_religious_decision.102.d

	trigger = {
		capital_province = {
			county = {
				has_variable = tragical_anima
			}
		}
		faith = {
			has_doctrine_parameter = anima_shrines_active
		} 
		NOT = {
			has_variable = patron_anima
		}
	}
	immediate = {
		capital_province = {
			county = {
				save_scope_as = shrine_location
			}
		}
		scope:shrine_location = {
			root = {
				set_variable = {
					name = tragical_anima
					value = prev.var:tragical_anima
				}
			}
		}		
	}
	theme = faith
	override_background = {
		trigger = {	scope:at_home = yes }
		event_background = temple_church
	}
	override_background = {
		trigger = {	scope:at_home = no }
		event_background = wilderness_scope
	}
	left_portrait = root
	option = {
		name = ate_religious_decision.102.a
		custom_tooltip = anima_established_effect
		remove_trait = patron_difunta_correa
		remove_trait = patron_balmaceda
		remove_trait = patron_ceferino
		scope:shrine_location = {
			set_variable = {
				name = established_anima
				value = var:tragical_anima
			}
			if = {
				limit = {
					var:tragical_anima = {
						has_trait = intellect_good_3
					}
				}
				root = {
					set_variable = {
						name = patron_anima
						value = prev.var:tragical_anima
					}
					add_trait = patron_genius_anima
				}
			}		
			else_if = {
				limit = {
					var:tragical_anima = {
						effective_age < 16
					}
				}
				root = {
					set_variable = {
						name = patron_anima
						value = prev.var:tragical_anima
					}				
					add_trait = patron_child_anima
				}
			}
			else_if = {
				limit = {
					var:tragical_anima = {
						OR = {
							has_trait = education_intrigue_1
							has_trait = education_intrigue_2
							has_trait = education_intrigue_3
							has_trait = education_intrigue_4
						}
					}
				}
				root = {
					set_variable = {
						name = patron_anima
						value = prev.var:tragical_anima
					}				
					add_trait = patron_intrigue_anima
				}
			}
			else_if = {
				limit = {
					var:tragical_anima = {
						OR = {
							has_trait = education_diplomacy_1
							has_trait = education_diplomacy_2
							has_trait = education_diplomacy_3
							has_trait = education_diplomacy_4
						}
					}
				}
				root = {
					set_variable = {
						name = patron_anima
						value = prev.var:tragical_anima
					}
					add_trait = patron_diplomacy_anima
				}
			}
			else_if = {
				limit = {
					var:tragical_anima = {
						OR = {
							has_trait = education_stewardship_1
							has_trait = education_stewardship_2
							has_trait = education_stewardship_3
							has_trait = education_stewardship_4
						}
					}
				}
				root = {
					set_variable = {
						name = patron_anima
						value = prev.var:tragical_anima
					}
					add_trait = patron_stewardship_anima
				}
			}
			else_if = {
				limit = {
					var:tragical_anima = {
						OR = {
							has_trait = education_martial_prowess_1
							has_trait = education_martial_prowess__2
							has_trait = education_martial_prowess_3
							has_trait = education_martial_prowess_4
						}
					}
				}
				root = {
					set_variable = {
						name = patron_anima
						value = prev.var:tragical_anima
					}				
					add_trait = patron_prowess_anima
				}
			}
			else_if = {
				limit = {
					var:tragical_anima = {
						OR = {
							has_trait = education_martial_1
							has_trait = education_martial_2
							has_trait = education_martial_3
							has_trait = education_martial_4
						}
					}
				}
				root = {
					set_variable = {
						name = patron_anima
						value = prev.var:tragical_anima
					}				
					add_trait = patron_martial_anima
				}
			}
			else_if = {
				limit = {
					var:tragical_anima = {
						OR = {
							has_trait = education_learning_1
							has_trait = education_learning_2
							has_trait = education_learning_3
							has_trait = education_learning_4
						}
					}
				}
				root = {
					set_variable = {
						name = patron_anima
						value = prev.var:tragical_anima
					}				
					add_trait = patron_learning_anima
				}
			}				
		}		
	}

	option = { #not for me
		name = ate_religious_decision.102.b
		custom_tooltip = anima_established_effect
		scope:shrine_location = {
			set_variable = {
				name = established_anima
				value = var:tragical_anima
			}
		}
	}	

}

#Anima selection
ate_religious_decision.103 = {
	title = ate_religious_decision.103.t
	desc = ate_religious_decision.103.d

	trigger = {
		faith = {
			has_doctrine_parameter = anima_shrines_active
		} 
	}
	immediate = {
		capital_province = {
			county = {
				save_scope_as = shrine_location
			}
		}
		scope:shrine_location = {
			if  = {
				limit = {
					scope:shrine_location = {
						has_variable = established_anima
					}
				}
				root = {
					set_variable = {
						name = temporary_established_anima
						value = prev.var:established_anima
					}
				}
			}
		}
		root = {
			set_variable = {
				name = temporary_greater_anima_1
				value = global_var:greater_anima_1
				days = 7
			}
			set_variable = {
				name = temporary_greater_anima_2
				value = global_var:greater_anima_2
				days = 7
			}
			set_variable = {
				name = temporary_greater_anima_3
				value = global_var:greater_anima_3
				days = 7
			}
		}
	}
	theme = faith
	override_background = {
		trigger = {	scope:at_home = yes }
		event_background = temple_church
	}
	override_background = {
		trigger = {	scope:at_home = no }
		event_background = wilderness_scope
	}
	left_portrait = root
	option = {
		name = ate_religious_decision.103.a
		add_trait = patron_difunta_correa
		remove_variable = temporary_established_anima
		if = {
			limit = {
				NOT = { has_variable = temporary_established_anima }
				has_global_variable = greater_anima_1					
			}
			add_gold = 150
		}
	}
	option = {
		name = ate_religious_decision.103.b
		add_trait = patron_balmaceda
		remove_variable = temporary_established_anima
	}
	option = {
		name = ate_religious_decision.103.h
		add_trait = patron_ceferino
		remove_variable = temporary_established_anima
	}
	option = {
		name = ate_religious_decision.103.c
		trigger = {
			has_variable = temporary_established_anima
		}
		if = {
			limit = {
				var:temporary_established_anima = {
					has_trait = intellect_good_3
				}
			}
			add_trait = patron_genius_anima
		}		
		else_if = {
			limit = {
				var:temporary_established_anima = {
					effective_age < 16
				}
			}
			add_trait = patron_child_anima
		}
		else_if = {
			limit = {
				var:temporary_established_anima = {
					OR = {
						has_trait = education_intrigue_1
						has_trait = education_intrigue_2
						has_trait = education_intrigue_3
						has_trait = education_intrigue_4
					}
				}
			}
			add_trait = patron_intrigue_anima
		}
		else_if = {
			limit = {
				var:temporary_established_anima = {
					OR = {
						has_trait = education_diplomacy_1
						has_trait = education_diplomacy_2
						has_trait = education_diplomacy_3
						has_trait = education_diplomacy_4
					}
				}
			}
			add_trait = patron_diplomacy_anima
		}
		else_if = {
			limit = {
				var:temporary_established_anima = {
					OR = {
						has_trait = education_stewardship_1
						has_trait = education_stewardship_2
						has_trait = education_stewardship_3
						has_trait = education_stewardship_4
					}
				}
			}
			add_trait = patron_stewardship_anima
		}
		else_if = {
			limit = {
				var:temporary_established_anima = {
					OR = {
						has_trait = education_martial_prowess_1
						has_trait = education_martial_prowess__2
						has_trait = education_martial_prowess_3
						has_trait = education_martial_prowess_4
					}
				}
			}
			add_trait = patron_prowess_anima
		}
		else_if = {
			limit = {
				var:temporary_established_anima = {
					OR = {
						has_trait = education_martial_1
						has_trait = education_martial_2
						has_trait = education_martial_3
						has_trait = education_martial_4
					}
				}
			}
			add_trait = patron_martial_anima
		}
		else_if = {
			limit = {
				var:temporary_established_anima = {
					OR = {
						has_trait = education_learning_1
						has_trait = education_learning_2
						has_trait = education_learning_3
						has_trait = education_learning_4
					}
				}
			}
			add_trait = patron_learning_anima
		}
		set_variable = {
			name = patron_anima
			value = var:temporary_established_anima
		}
		remove_variable = temporary_established_anima
	}
	option = {
		name = ate_religious_decision.103.e
		trigger = {
			trigger_if = {
				limit = {
					has_variable = temporary_established_anima
					has_global_variable = greater_anima_1
				}
				var:temporary_established_anima = {
					compare_value != global_var:greater_anima_1
				}
			}
			trigger_else_if = {
				limit = {
					NOT = { has_variable = temporary_established_anima }
					has_global_variable = greater_anima_1					
				}
				has_global_variable = greater_anima_1
			}
			trigger_else = {
				always = no
			}
		}
		if = { 
			limit = {
				global_var:greater_anima_1 = {
					has_trait = intellect_good_3
				}
			}
			add_trait = patron_genius_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_1 = {
					effective_age < 16
				}
			}
			add_trait = patron_child_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_1 = {
					OR = {
						has_trait = education_intrigue_1
						has_trait = education_intrigue_2
						has_trait = education_intrigue_3
						has_trait = education_intrigue_4
					}
				}
			}
			add_trait = patron_intrigue_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_1 = {
					OR = {
						has_trait = education_diplomacy_1
						has_trait = education_diplomacy_2
						has_trait = education_diplomacy_3
						has_trait = education_diplomacy_4
					}
				}
			}
			add_trait = patron_diplomacy_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_1 = {
					OR = {
						has_trait = education_stewardship_1
						has_trait = education_stewardship_2
						has_trait = education_stewardship_3
						has_trait = education_stewardship_4
					}
				}
			}
			add_trait = patron_stewardship_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_1 = {
					OR = {
						has_trait = education_martial_prowess_1
						has_trait = education_martial_prowess__2
						has_trait = education_martial_prowess_3
						has_trait = education_martial_prowess_4
					}
				}
			}
			add_trait = patron_prowess_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_1 = {
					OR = {
						has_trait = education_martial_1
						has_trait = education_martial_2
						has_trait = education_martial_3
						has_trait = education_martial_4
					}
				}
			}
			add_trait = patron_martial_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_1 = {
					OR = {
						has_trait = education_learning_1
						has_trait = education_learning_2
						has_trait = education_learning_3
						has_trait = education_learning_4
					}
				}
			}
			add_trait = patron_learning_anima
		}
		set_variable = {
			name = patron_anima
			value = global_var:greater_anima_1
		}
		remove_variable = temporary_established_anima
	}
	option = {
		name = ate_religious_decision.103.f
		trigger = {
			trigger_if = {
				limit = {
					has_variable = temporary_established_anima
					has_global_variable = greater_anima_2
				}
				var:temporary_established_anima = {
					compare_value != global_var:greater_anima_2
				}
			}
			trigger_else_if = {
				limit = {
					NOT = { has_variable = temporary_established_anima }
					has_global_variable = greater_anima_2					
				}
				has_global_variable = greater_anima_2
			}
			trigger_else = {
				always = no
			}
		}
		if = {
			limit = {
				global_var:greater_anima_2 = {
					has_trait = intellect_good_3
				}
			}
			add_trait = patron_genius_anima
		}		
		else_if = {
			limit = {
				global_var:greater_anima_2 = {
					effective_age < 16
				}
			}
			add_trait = patron_child_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_2 = {
					OR = {
						has_trait = education_intrigue_1
						has_trait = education_intrigue_2
						has_trait = education_intrigue_3
						has_trait = education_intrigue_4
					}
				}
			}
			add_trait = patron_intrigue_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_2 = {
					OR = {
						has_trait = education_diplomacy_1
						has_trait = education_diplomacy_2
						has_trait = education_diplomacy_3
						has_trait = education_diplomacy_4
					}
				}
			}
			add_trait = patron_diplomacy_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_2 = {
					OR = {
						has_trait = education_stewardship_1
						has_trait = education_stewardship_2
						has_trait = education_stewardship_3
						has_trait = education_stewardship_4
					}
				}
			}
			add_trait = patron_stewardship_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_2 = {
					OR = {
						has_trait = education_martial_prowess_1
						has_trait = education_martial_prowess__2
						has_trait = education_martial_prowess_3
						has_trait = education_martial_prowess_4
					}
				}
			}
			add_trait = patron_prowess_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_2 = {
					OR = {
						has_trait = education_martial_1
						has_trait = education_martial_2
						has_trait = education_martial_3
						has_trait = education_martial_4
					}
				}
			}
			add_trait = patron_martial_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_2 = {
					OR = {
						has_trait = education_learning_1
						has_trait = education_learning_2
						has_trait = education_learning_3
						has_trait = education_learning_4
					}
				}
			}
			add_trait = patron_learning_anima
		}
		set_variable = {
			name = patron_anima
			value = global_var:greater_anima_2
		}
		remove_variable = temporary_established_anima
	}
	option = {
		name = ate_religious_decision.103.g
		trigger = {
			trigger_if = {
				limit = {
					has_variable = temporary_established_anima
					has_global_variable = greater_anima_3
				}
				var:temporary_established_anima = {
					compare_value != global_var:greater_anima_3
				}
			}
			trigger_else_if = {
				limit = {
					NOT = { has_variable = temporary_established_anima }
					has_global_variable = greater_anima_3				
				}
				has_global_variable = greater_anima_3
			}
			trigger_else = {
				always = no
			}
		}
		if = {
			limit = {
				global_var:greater_anima_3 = {
					has_trait = intellect_good_3
				}
			}
			add_trait = patron_genius_anima
		}		
		else_if = {
			limit = {
				global_var:greater_anima_3 = {
					effective_age < 16
				}
			}
			add_trait = patron_child_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_3 = {
					OR = {
						has_trait = education_intrigue_1
						has_trait = education_intrigue_2
						has_trait = education_intrigue_3
						has_trait = education_intrigue_4
					}
				}
			}
			add_trait = patron_intrigue_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_3 = {
					OR = {
						has_trait = education_diplomacy_1
						has_trait = education_diplomacy_2
						has_trait = education_diplomacy_3
						has_trait = education_diplomacy_4
					}
				}
			}
			add_trait = patron_diplomacy_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_1 = {
					OR = {
						has_trait = education_stewardship_1
						has_trait = education_stewardship_2
						has_trait = education_stewardship_3
						has_trait = education_stewardship_4
					}
				}
			}
			add_trait = patron_stewardship_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_3 = {
					OR = {
						has_trait = education_martial_prowess_1
						has_trait = education_martial_prowess__2
						has_trait = education_martial_prowess_3
						has_trait = education_martial_prowess_4
					}
				}
			}
			add_trait = patron_prowess_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_3 = {
					OR = {
						has_trait = education_martial_1
						has_trait = education_martial_2
						has_trait = education_martial_3
						has_trait = education_martial_4
					}
				}
			}
			add_trait = patron_martial_anima
		}
		else_if = {
			limit = {
				global_var:greater_anima_3 = {
					OR = {
						has_trait = education_learning_1
						has_trait = education_learning_2
						has_trait = education_learning_3
						has_trait = education_learning_4
					}
				}
			}
			add_trait = patron_learning_anima
		}
		set_variable = {
			name = patron_anima
			value = global_var:greater_anima_3
		}
		remove_variable = temporary_established_anima
	}
}
#Anima Sanctuary
ate_religious_decision.104 = {
	title = ate_religious_decision.104.t
	desc = ate_religious_decision.104.d

	trigger = {
		capital_province = {
			county = {
				has_variable = established_anima
			}
		}
		faith = {
			has_doctrine_parameter = anima_shrines_active
		} 
	}
	immediate = {
		capital_province = {
			county = {
				save_scope_as = shrine_location
			}
		}
		scope:shrine_location = {
			if  = {
				limit = {
					scope:shrine_location = {
						has_variable = established_anima
					}
				}
				root = {
					set_variable = {
						name = temporary_established_anima
						value = prev.var:established_anima
					}
				}
			}
		}		
	}
	theme = faith
	override_background = {
		trigger = {	scope:at_home = yes }
		event_background = temple_church
	}
	override_background = {
		trigger = {	scope:at_home = no }
		event_background = wilderness_scope
	}
	left_portrait = root
	option = {
		name = ate_religious_decision.104.a
		custom_tooltip = anima_made_greater_effect
		scope:shrine_location = {
			if = {
				limit = {
					NOT = {
						has_global_variable = greater_anima_1
					}
				}
				set_global_variable = {
					name = greater_anima_1
					value = var:established_anima
				}
			}
			else_if = {
				limit = {
					NOT = {
						has_global_variable = greater_anima_2
					}
				}
				set_global_variable = {
					name = greater_anima_2
					value = var:established_anima
				}				
			}
			else = {
				set_global_variable = {
					name = greater_anima_3
					value = var:established_anima
				}					
			}
			remove_county_modifier = county_dedicated_anima_shrine
			add_county_modifier = {
				modifier = county_dedicated_anima_sanctuary
			}			
		}

	}	
}